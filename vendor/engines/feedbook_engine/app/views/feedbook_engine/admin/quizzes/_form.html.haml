= simple_form_for [:admin, @quiz] do |f|
  = render partial: 'shared/errors', locals: { resource: @quiz }
  .col-md-3
    .span3
  .col-md-6
    .span6
      .field
        = f.input :name
      .field
        = f.input :description
      .field
        = f.input :summary
      .field
        = f.input :duration, placelholder: 'in seconds'
      .field
        = f.input :distribution_rules
        .sliders-wrapper{ style: 'margin: 0 auto; width: 100px;'}
          #low-level{ style: "height: 100px; display: inline-block; margin-right: 20px;" }
          #mid-level{ style: "height: 100px; display: inline-block; margin-right: 20px;" }
          #high-level{ style: "height: 100px; display: inline-block; margin-right: 20px;" }
      .field
        = f.input :distribution_skills, placeholder: 'skill names, comma separated'
      .actions.clearfix
        = link_to 'Cancel', admin_quizzes_path, class: 'btn btn-disabled'
        = f.submit 'Save', class: 'btn'
  .col-md-3
    .span3

.clearfix

:javascript
  function keepAspectRatio(slider){
    var totalPoints = 0,
        values = [];
    $.each(["#low-level", "#mid-level", "#high-level"], function(i, ele){
      totalPoints += $(ele).slider("value");
    });

    $.each(["#low-level", "#mid-level", "#high-level"], function(i, ele){
      var value = Math.round(($(ele).slider("value") * 100) / totalPoints);

      // Ensure sum of distribution ranges are 100
      var isRoundedCorrectly = _.reduce(_.flatten([values, value]), function(memo, num){ return memo + num; }, 0) == 100;
      if (i == 2 && !isRoundedCorrectly){
        value = 100 - _.reduce(values, function(memo, num){ return memo + num; }, 0)
      }

      values.push(value);
      $(ele).slider("value", value);
    });

    $('#quiz_distribution_rules').val(values.join('-'));
  }

  function loadValues(values){
    var values = eval(values);
    $("#low-level").slider("value", values[0]);
    $("#mid-level").slider("value", values[1]);
    $("#high-level").slider("value", values[2]);
    $('#quiz_distribution_rules').val(values.join('-'));
  }

  $(function() {
    $("#low-level, #mid-level, #high-level").slider({
      orientation: "vertical",
      range: "min",
      min: 1,
      max: 100,
      value: 20,
      slide: function( event, ui ) {
        if (event.originalEvent) {
          keepAspectRatio(ui);
        }
      }
    });
    $("#mid-level").slider("value", 60);

    loadValues("#{ @quiz.distribution_params }");
  });
